<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Public Chat App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#50f3ff;
  font-family:Arial, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.app{
  width:360px;
  height:640px;
  background:#031a2c;
  border-radius:16px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  color:white;
}
.header{
  padding:12px;
  background:#9948f0;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:bold;
}
.header button{
  background:none;
  border:none;
  color:white;
  font-size:18px;
  cursor:pointer;
}
.messages{
  flex:1;
  padding:10px;
  overflow-y:auto;
}
.msg{
  max-width:75%;
  padding:8px 12px;
  border-radius:12px;
  margin-bottom:8px;
  word-wrap:break-word;
}
.me{background:#0b47ae;margin-left:auto;}
.other{background:#088a15;margin-right:auto;}
small{font-size:10px;opacity:0.7;}
.input{
  display:flex;
  padding:8px;
  gap:6px;
}
input{
  flex:1;
  padding:10px;
  border-radius:20px;
  border:none;
  outline:none;
}
button.send{
  border:none;
  padding:10px 14px;
  border-radius:50%;
  background:#22c55e;
  color:white;
  cursor:pointer;
}
button.attach{
  background:#eab308;
  border:none;
  padding:10px;
  border-radius:50%;
  cursor:pointer;
}
img,video{
  max-width:200px;
  border-radius:10px;
  margin-top:5px;
}
</style>
</head>

<body>

<div class="app">
  <div class="header">
    <i>ðŸ’¬ Frinds Chat</i>
    <button onclick="startCall()">ðŸ“ž</button>
  </div>

  <div class="messages" id="messages"></div>

  <div class="input">
    <button class="attach" onclick="fileInput.click()">ðŸ“Ž</button>
    <input id="text" placeholder="Type message...">
    <button class="send" onclick="send()">âž¤</button>
  </div>
</div>

<input type="file" id="fileInput" hidden accept="image/*,video/*">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<script>
/* ðŸ”´ FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyAgz2d5if6IxrgX38Pyd-ATTGkCI-mS9v4",
  authDomain: "my-self-web.firebaseapp.com",
  databaseURL: "https://my-self-web-default-rtdb.firebaseio.com",
  projectId: "my-self-web",
  storageBucket: "my-self-web.appspot.com",
  messagingSenderId: "104834208006",
  appId: "1:104834208006:web:14bdfe4dbef4c6f6c10e87"
});

const db = firebase.database();
const storage = firebase.storage();
const chat = db.ref("chat");
const box = document.getElementById("messages");

/* USER NAME */
let username = localStorage.getItem("chat_username");
if(!username){
  username = prompt("Enter your name");
  if(!username) username = "Guest";
  localStorage.setItem("chat_username", username);
}

/* NOTIFICATIONS */
if(Notification.permission !== "granted"){
  Notification.requestPermission();
}

/* SEND TEXT */
function send(){
  const t = text.value.trim();
  if(!t) return;

  chat.push({
    user: username,
    text: t,
    time: Date.now()
  });

  text.value = "";
}

/* SEND IMAGE / VIDEO */
fileInput.onchange = e=>{
  const file = e.target.files[0];
  if(!file) return;

  const ref = storage.ref("media/" + Date.now() + file.name);
  ref.put(file).then(snap =>
    snap.ref.getDownloadURL().then(url=>{
      chat.push({
        user: username,
        media: url,
        type: file.type.startsWith("video") ? "video" : "image",
        time: Date.now()
      });
    })
  );
};

/* RECEIVE MESSAGES */
chat.on("child_added", snap=>{
  const m = snap.val();
  const div = document.createElement("div");
  div.className = "msg " + (m.user === username ? "me" : "other");

  const name = m.user === username ? "You" : m.user;
  div.innerHTML = `<b>${name}</b><br>`;

  if(m.text) div.innerHTML += m.text;
  if(m.media){
    div.innerHTML += m.type === "image"
      ? `<img src="${m.media}">`
      : `<video src="${m.media}" controls></video>`;
  }

  div.innerHTML += `<br><small>${new Date(m.time).toLocaleTimeString()}</small>`;

  /* DELETE MESSAGE */
  div.oncontextmenu = e=>{
    e.preventDefault();
    if(confirm("Delete message for everyone?")){
      chat.child(snap.key).remove();
    }
  };

  box.appendChild(div);
  box.scrollTop = box.scrollHeight;

  if(Notification.permission === "granted" && m.user !== username){
    new Notification("New message", { body: m.text || "Media received" });
  }
});

/* DEMO CALL (CAMERA + MIC) */
function startCall(){
  navigator.mediaDevices.getUserMedia({video:true,audio:true})
  .then(stream=>{
    const overlay = document.createElement("div");
    overlay.style = `
      position:fixed;
      inset:0;
      background:black;
      z-index:999;
      display:flex;
      justify-content:center;
      align-items:center;
    `;

    const video = document.createElement("video");
    video.srcObject = stream;
    video.autoplay = true;
    video.style = "width:90%;border-radius:12px";

    const end = document.createElement("button");
    end.innerText = "End Call";
    end.style = `
      position:absolute;
      bottom:30px;
      padding:12px 20px;
      background:red;
      border:none;
      color:white;
      border-radius:20px;
      font-size:16px;
    `;
    end.onclick = ()=>{
      stream.getTracks().forEach(t=>t.stop());
      overlay.remove();
    };

    overlay.append(video, end);
    document.body.appendChild(overlay);
  })
  .catch(()=>alert("Camera or mic permission denied"));
}
</script>

</body>
</html>